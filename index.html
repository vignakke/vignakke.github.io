<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi de Portefeuille Crypto</title>
    <style>
        :root {
            --background: #0f172a; /* Bleu ardoise foncé */
            --card-bg: rgba(15, 23, 42, 0.5); /* Ardoise foncée semi-transparente */
            --card-hover: rgba(30, 41, 59, 0.6); /* Ardoise légèrement plus claire au survol */
            --border: rgba(51, 65, 85, 0.3); /* Bordure ardoise plus douce */
            --text: #e2e8f0; /* Texte gris clair */
            --text-secondary: #94a3b8; /* Texte gris atténué */
            --accent: #34d399; /* Vert émeraude */
            --negative: #f87171; /* Rouge doux */
            --positive: #34d399; /* Vert émeraude */
            --primary-btn: #2dd4bf; /* Sarcelle */
            --primary-btn-hover: #5eead4; /* Sarcelle plus claire */
            --danger-btn: #ef4444; /* Rouge */
            --danger-btn-hover: #f87171; /* Rouge plus clair */
            --danger-bg: rgba(239, 68, 68, 0.15); /* Rouge transparent plus doux */
            --input-focus: rgba(45, 212, 191, 0.2); /* Lueur de focus sarcelle plus subtile */
            --shadow-color: rgba(0, 0, 0, 0.2); /* Ombre plus douce */
            --summary-item-bg: rgba(30, 41, 59, 0.4); /* Fond légèrement différent pour les éléments du résumé */
            --blur-intensity: 5px; /* Contrôle du flou pour le mode privé */
            --border-radius-main: 0.75rem; /* 12px */
            --border-radius-inner: 0.5rem; /* 8px */
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--background); color: var(--text);
            margin: 0;
            padding: 40px 20px 75px 20px;
            line-height: 1.6;
            display: flex; justify-content: center; min-height: 100vh;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }

        body.privacy-enabled .sensitive-data > *:not(input):not(.dollar-sign):not(.currency-symbol),
        body.privacy-enabled .sensitive-data input { filter: blur(var(--blur-intensity)); transition: filter 0.2s ease; pointer-events: none; user-select: none; }
        body.privacy-enabled .sensitive-data .dollar-sign, body.privacy-enabled .sensitive-data .currency-symbol { filter: none; pointer-events: auto; user-select: auto; }
        body.privacy-enabled .sensitive-data input { background-color: rgba(51, 65, 85, 0.2) !important; color: transparent !important; text-shadow: 0 0 var(--blur-intensity) rgba(148, 163, 184, 0.5) !important; border-color: transparent !important; }
        body.privacy-enabled .sensitive-data .price-input-container input { text-shadow: none !important; }
        body.privacy-enabled .summary-item.sensitive-summary .summary-value > * { filter: blur(var(--blur-intensity)); pointer-events: none; user-select: none; }
        body.privacy-enabled .summary-item.sensitive-summary .summary-value .currency-symbol { filter: none; }

        .container { width: 100%; max-width: 1100px; margin: 0 auto; }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
            padding: 0 5px;
        }
        .header-content {
             text-align: left;
        }
        .portfolio-title {
            font-size: 20px;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 2px;
            line-height: 1.3;
        }
        .portfolio-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 0;
            line-height: 1.4;
            max-width: 100%;
        }
        #privacyToggle {
             margin-left: 0; /* Ajusté car le bouton bonus est avant */
            background: transparent; border: 1px solid var(--border); color: var(--text-secondary);
            padding: 6px; border-radius: 50%; cursor: pointer; font-size: 16px; line-height: 1;
            width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease; flex-shrink: 0;
        }
         #privacyToggle:hover { background-color: var(--card-hover); color: var(--text); border-color: var(--text-secondary); }
         #privacyToggle .feather-eye-off { display: none; }
         body.privacy-enabled #privacyToggle .feather-eye { display: none; }
         body.privacy-enabled #privacyToggle .feather-eye-off { display: inline-block; }
         
         /* Style for the new button (can be customized) */
        #bonusHuntBtn:hover { background-color: var(--card-hover); color: var(--text); border-color: var(--text-secondary); }


        @keyframes gradient-shift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .animated-gradient-card { position: relative; overflow: hidden; border-radius: var(--border-radius-main); background: var(--card-bg); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); padding: 28px; margin-bottom: 30px; box-shadow: 0 6px 18px var(--shadow-color); border: 1px solid var(--border); transition: all 0.3s ease; }
        .animated-gradient-card:hover { transform: translateY(-2px); box-shadow: 0 8px 22px var(--shadow-color); }
        .animated-gradient-card::before { content: ""; position: absolute; inset: -2px; background: linear-gradient(60deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.15), rgba(236, 72, 153, 0.15)); background-size: 250% 250%; z-index: -1; filter: blur(10px); opacity: 0.5; animation: gradient-shift 10s ease infinite; border-radius: calc(var(--border-radius-main) + 2px); pointer-events: none; }

        .glassmorphism-mini-chart { position: relative; overflow: hidden; border-radius: var(--border-radius-inner); background: var(--summary-item-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding: 18px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15); border: 1px solid rgba(255, 255, 255, 0.05); transition: filter 0.3s ease; }
        .glassmorphism-mini-chart::before { content: ""; position: absolute; inset: -1px; background: linear-gradient(60deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2), rgba(236, 72, 153, 0.2)); background-size: 250% 250%; z-index: -1; filter: blur(8px); opacity: 0.4; animation: gradient-shift 8s ease infinite; border-radius: calc(var(--border-radius-inner) + 1px); pointer-events: none; }

        .top-section { display: grid; grid-template-columns: 1fr; gap: 30px; }
        @media (min-width: 992px) { .top-section { grid-template-columns: 1.1fr 0.9fr; } }
        .input-container { display: flex; flex-direction: column; gap: 20px; }
        .input-group { display: grid; grid-template-columns: 1fr; gap: 18px; margin-bottom: 20px; }
        @media (min-width: 576px) { .input-group { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); } }
        .form-control { width: 100%; position: relative; }
        .form-label { display: block; font-size: 12px; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }

        input { width: 100%; padding: 10px 14px; border-radius: var(--border-radius-inner); border: 1px solid var(--border); background-color: rgba(15, 23, 42, 0.6); color: var(--text); font-size: 14px; transition: all 0.2s; height: 42px; }
        input::placeholder { color: var(--text-secondary); opacity: 0.6; }
        input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 2px var(--input-focus); }

        .input-group .price-input-container { position: relative; }
        .input-group .price-input-container #purchasePrice { padding-left: 24px; }
        .input-group .price-input-container .dollar-sign { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); opacity: 0.7; z-index: 1; font-size: 14px; pointer-events: none; }

        button { padding: 0 20px; height: 42px; border-radius: var(--border-radius-inner); border: none; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; text-transform: none; letter-spacing: 0.3px; display: inline-flex; align-items: center; justify-content: center; }
        .btn-primary { background-color: var(--primary-btn); color: #0f172a; width: 100%; }
        .btn-primary:hover { background-color: var(--primary-btn-hover); transform: translateY(-1px); box-shadow: 0 3px 8px rgba(45, 212, 191, 0.15); }
        .btn-danger { background-color: var(--danger-btn); color: #fff; }
        .btn-danger:hover { background-color: var(--danger-btn-hover); transform: translateY(-1px); box-shadow: 0 3px 8px rgba(239, 68, 68, 0.15); }
        .btn-cancel { background-color: transparent; color: var(--text-secondary); border: 1px solid var(--border); }
        .btn-cancel:hover { background-color: var(--card-hover); color: var(--text); border-color: var(--text-secondary); }

        .section-title { font-size: 18px; font-weight: 500; margin-bottom: 24px; color: var(--text); border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .summary-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
        @media (min-width: 576px) { .summary-grid { grid-template-columns: repeat(3, 1fr); } }
        .summary-item { transition: filter 0.3s ease; }
        .summary-label { font-size: 11px; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.8px; }
        .summary-value { font-size: 20px; font-weight: 600; }
        .positive { color: var(--positive); }
        .negative { color: var(--negative); }

        table { width: 100%; border-collapse: separate; border-spacing: 0; }
        th, td { padding: 14px 12px; text-align: left; font-size: 13px; vertical-align: middle; transition: filter 0.3s ease; }
        th { color: var(--text-secondary); font-weight: 500; border-bottom: 1px solid var(--border); text-transform: uppercase; font-size: 10px; letter-spacing: 1px; }
        td { border-bottom: 1px solid var(--border); }
        tbody tr:last-child td { border-bottom: none; }
        tbody tr { transition: background-color 0.15s ease; }
        tbody tr:hover { background-color: var(--card-hover); }

        .coin-info { display: flex; align-items: center; gap: 12px; }
        .coin-icon { width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(45deg, var(--accent), var(--primary-btn)); color: var(--background); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 13px; flex-shrink: 0; }
        .coin-name { display: flex; flex-direction: column; }
        .coin-symbol { font-weight: 500; font-size: 14px; }
        .coin-fullname { font-size: 11px; color: var(--text-secondary); margin-top: 1px; }
        .align-right { text-align: right; }
        .price-change { display: flex; gap: 8px; align-items: center; justify-content: flex-start; }
        .percentage { font-size: 0.9em; opacity: 0.95; padding: 2px 6px; border-radius: 4px; font-weight: 500; flex-shrink: 0; display: inline-block; line-height: 1.3; }
        .percentage.positive { background-color: rgba(52, 211, 153, 0.1); color: var(--positive); }
        .percentage.negative { background-color: rgba(248, 113, 113, 0.1); color: var(--negative); }
        td:nth-child(6) .percentage { margin-left: 6px; }
        .add-btn-container { display: flex; justify-content: center; align-items: center; margin-top: 10px; }

        .tooltip { position: relative; display: inline-block; cursor: default; }
        .tooltip .tooltiptext { visibility: hidden; min-width: 100px; background-color: #111827; color: var(--text); text-align: center; border-radius: 6px; padding: 5px 8px; position: absolute; z-index: 101; bottom: 145%; left: 50%; transform: translateX(-50%); margin-left: 0; opacity: 0; transition: opacity 0.2s ease, visibility 0s linear 0.2s; font-size: 11px; box-shadow: 0 2px 6px rgba(0,0,0,0.4); pointer-events: none; }
        .tooltip .tooltiptext::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -4px; border-width: 4px; border-style: solid; border-color: #111827 transparent transparent transparent; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; transition: opacity 0.2s ease; }

        @media (max-width: 767px) {
            header { flex-direction: column; align-items: center; text-align: center; gap: 15px; }
            .header-content { text-align: center; }
            #privacyToggle { position: static; margin-left: 0; margin-top: 10px; }
            /* Ensure the div containing buttons also stacks correctly */
            header > div:last-child { display: flex; justify-content: center; margin-top:10px;}
            #bonusHuntBtn { margin-right: 10px !important; } 
            .responsive-table { overflow-x: auto; -webkit-overflow-scrolling: touch; border: 1px solid var(--border); border-radius: var(--border-radius-inner); margin: 0 -15px; padding: 0 15px; }
            table { min-width: 680px; }
            th, td { padding: 12px 10px; font-size: 12px; white-space: nowrap; }
            .coin-info { gap: 10px; }
            .coin-icon { width: 28px; height: 28px; font-size: 12px; }
            .animated-gradient-card { padding: 20px; }
        }

        .footer { margin-top: 60px; padding-top: 40px; border-top: 1px solid var(--border); text-align: center; }
        .donation-info { margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .donation-title { font-size: 15px; font-weight: 500; margin-bottom: 20px; color: var(--text); }
        .donation-address { margin-bottom: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; flex-wrap: wrap; }
        .donation-address strong { color: var(--accent); font-weight: 500; flex-shrink: 0; font-size: 12px; }
        .address { font-family: 'Fira Code', monospace; word-break: break-all; color: var(--text-secondary); font-size: 11px; background-color: rgba(51, 65, 85, 0.2); padding: 3px 6px; border-radius: 4px; display: inline-block; }

        .editable-amount, .editable-price { background-color: transparent; border: 1px solid transparent; border-radius: 6px; padding: 5px 8px; width: 100%; max-width: 95px; color: var(--text); font-size: 13px; text-align: right; transition: all 0.15s ease; height: 30px; }
        .editable-amount:hover, .editable-price:hover { border-color: var(--border); background-color: rgba(51, 65, 85, 0.3); }
        .editable-amount:focus, .editable-price:focus { border-color: var(--accent); background-color: rgba(15, 23, 42, 0.7); outline: none; box-shadow: 0 0 0 2px var(--input-focus); }
        body.privacy-enabled td.sensitive-data .editable-amount, body.privacy-enabled td.sensitive-data .editable-price { filter: blur(var(--blur-intensity)); color: transparent !important; text-shadow: 0 0 var(--blur-intensity) rgba(148, 163, 184, 0.5) !important; pointer-events: none; user-select: none; border-color: transparent !important; background-color: transparent !important; }

        .dollar-sign, .currency-symbol { color: var(--text-secondary); margin-right: 1px; font-size: 0.95em; transition: filter 0.3s ease; opacity: 0.8; }
        td .price-input-container { display: flex; align-items: center; position: relative; max-width: 95px; margin-left: auto; }
        td .price-input-container .dollar-sign { position: absolute; left: 6px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); z-index: 1; font-size: 11px; pointer-events: none; opacity: 0.7; }
        td .editable-price { padding-left: 16px; }

        .dropdown-suggestions { position: absolute; top: calc(100% + 4px); left: 0; right: 0; background-color: #111827; border: 1px solid var(--border); border-radius: var(--border-radius-inner); max-height: 200px; overflow-y: auto; z-index: 100; box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3); display: none; }
        .dropdown-suggestions.active { display: block; }
        .suggestion-item { padding: 10px 14px; cursor: pointer; transition: background-color 0.15s ease; display: flex; align-items: center; gap: 8px; }
        .suggestion-item:hover { background-color: var(--card-hover); }
        .suggestion-item .coin-symbol { font-weight: 500; color: var(--text); font-size: 13px; }
        .suggestion-item .coin-name { font-size: 11px; color: var(--text-secondary); margin-left: 0; }

        .dropdown-suggestions::-webkit-scrollbar { width: 6px; }
        .dropdown-suggestions::-webkit-scrollbar-track { background: transparent; }
        .dropdown-suggestions::-webkit-scrollbar-thumb { background: var(--border); border-radius: 6px; }
        .dropdown-suggestions::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }
        .editable { position: relative; }

        .trash-button { display: inline-flex; align-items: center; justify-content: center; width: 30px; height: 30px; border-radius: var(--border-radius-inner); border: 1px solid transparent; background-color: transparent; cursor: pointer; transition: all 0.15s ease; color: var(--negative); font-size: 16px; vertical-align: middle; }
        .trash-button:hover { background-color: var(--danger-bg); color: #fff; }
        .trash-button .feather { width: 14px; height: 14px; }
        body.privacy-enabled .trash-button .tooltiptext { filter: none; pointer-events: auto; user-select: auto; }

        .modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.2s ease, visibility 0s linear 0.2s; }
        .modal-overlay.active { opacity: 1; visibility: visible; transition: opacity 0.2s ease; }
        .modal-content { background-color: #1f2937; border-radius: var(--border-radius-main); padding: 24px; width: 90%; max-width: 400px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4); border: 1px solid var(--border); transform: scale(0.95); transition: all 0.25s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        .modal-title { font-size: 16px; font-weight: 500; color: var(--text); }
        #modalCoinIcon { width: 30px; height: 30px; flex-shrink: 0; }
        .modal-message { color: var(--text-secondary); margin-bottom: 24px; font-size: 13px; line-height: 1.6; }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; }
        .modal-actions button { min-width: 80px; height: 36px; font-size: 12px; }

        input[type="number"] { -moz-appearance: textfield; }
        input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="text"] { -moz-appearance: textfield; }

        th:nth-child(2), td:nth-child(2), th:nth-child(3), td:nth-child(3), th:nth-child(5), td:nth-child(5), th:nth-child(6), td:nth-child(6) { text-align: right; }
        th:first-child, td:first-child, th:nth-child(4), td:nth-child(4) { text-align: left; }
        th:last-child, td:last-child { text-align: right; }
        .feather { width: 1em; height: 1em; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; fill: none; display: inline-block; vertical-align: middle; position: relative; top: -1px; }

        .crypto-ticker-box {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 55px;
            background: linear-gradient(120deg, #1e3a8a, #5b21b6, #9d174d);
            background-size: 250% 250%;
            animation: gradient-shift 12s ease infinite;
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            padding: 0 10px;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.25);
            z-index: 1000;
            color: var(--text);
            display: flex;
            align-items: center;
            overflow-x: auto;
            overflow-y: hidden;
            justify-content: center;
        }
        .crypto-ticker-box::-webkit-scrollbar { height: 4px; }
        .crypto-ticker-box::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        .crypto-ticker-box::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 2px; }
        .crypto-ticker-box::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.5); }

        .crypto-ticker-item {
            display: flex;
            align-items: center;
            padding: 0 12px;
            white-space: nowrap;
            flex-shrink: 0;
            height: 100%;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        .crypto-ticker-item:last-child { border-right: none; }
        .crypto-ticker-item .crypto-ticker-symbol { font-weight: 500; color: var(--text); margin-right: 8px; font-size: 0.9em; }
        .crypto-ticker-item .crypto-ticker-price { color: var(--text-secondary); margin-right: 8px; font-size: 0.85em; }
        .crypto-ticker-item .crypto-ticker-change { display: inline-flex; align-items: center; }
        .crypto-ticker-item .crypto-ticker-change .percentage { font-size: 0.8em; }

    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <div class="container">
        <header>
            <div class="header-content">
                <h1 class="portfolio-title">Portefeuille Crypto</h1>
                <p class="portfolio-subtitle">Suivez vos actifs &amp; performances</p>
            </div>
            <div style="display: flex; align-items: center;">
                <button id="bonusHuntBtn" class="tooltip" style="margin-right: 10px; background: transparent; border: 1px solid var(--border); color: var(--text-secondary); padding: 6px; border-radius: 50%; cursor: pointer; font-size: 16px; line-height: 1; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; flex-shrink: 0;" onclick="window.location.href='https://vignakke.github.io/hunt.html/'">
                    <i data-feather="gift" class="feather"></i>
                    <span class="tooltiptext">Aller à Bonus Hunt</span>
                </button>
                <button id="privacyToggle" class="tooltip">
                    <i data-feather="eye" class="feather"></i>
                    <i data-feather="eye-off" class="feather"></i>
                     <span class="tooltiptext">Activer/Désactiver Mode Privé</span>
                </button>
            </div>
        </header>

        <div class="animated-gradient-card">
            <div class="top-section">
                <div class="input-container">
                    <h2 class="section-title">Ajouter un Actif</h2>
                    <div class="input-group">
                        <div class="form-control">
                            <label class="form-label" for="symbol">Symbole</label>
                            <input type="text" id="symbol" placeholder="BTC, ETH..." autocomplete="off" />
                            <div id="symbolSuggestions" class="dropdown-suggestions"></div>
                        </div>
                        <div class="form-control">
                            <label class="form-label" for="amount">Montant</label>
                            <input type="text" id="amount" placeholder="0.00" inputmode="decimal"/>
                        </div>
                        <div class="form-control">
                            <label class="form-label" for="purchasePrice">Prix d'Achat</label>
                            <div class="price-input-container">
                                <span class="dollar-sign">$</span>
                                <input type="text" id="purchasePrice" placeholder="0.00" inputmode="decimal"/>
                            </div>
                        </div>
                    </div>
                    <div class="add-btn-container">
                        <button id="addBtn" class="btn-primary">Ajouter l'Actif</button>
                    </div>
                </div>

                <div class="summary-container">
                    <h2 class="section-title">Résumé</h2>
                    <div class="summary-grid">
                        <div class="summary-item glassmorphism-mini-chart sensitive-summary">
                            <div class="summary-label">Investi</div>
                            <div class="summary-value"><span class="currency-symbol">$</span><span id="totalInvested">0.00</span></div>
                        </div>
                        <div class="summary-item glassmorphism-mini-chart sensitive-summary">
                            <div class="summary-label">Valeur Actuelle</div>
                            <div class="summary-value"><span class="currency-symbol">$</span><span id="totalValue">0.00</span></div>
                        </div>
                        <div class="summary-item glassmorphism-mini-chart sensitive-summary">
                            <div class="summary-label">P&amp;L Net</div>
                            <div class="summary-value" id="netProfitLossContainer">
                                <span class="currency-symbol">$</span><span id="netProfitLoss">0.00</span> <span class="percentage">(<span id="netProfitLossPercentage">0.00%</span>)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="animated-gradient-card">
            <h2 class="section-title">Actifs Détenus</h2>
            <div class="responsive-table">
                <table id="portfolioTable">
                    <thead>
                        <tr>
                            <th>Actif</th>
                            <th class="align-right">Montant</th>
                            <th class="align-right">Prix d'Achat Moyen</th>
                            <th>Prix Actuel</th>
                            <th class="align-right">Valeur Totale</th>
                            <th class="align-right">P&amp;L Net</th>
                            <th class="align-right"></th>
                        </tr>
                    </thead>
                    <tbody id="portfolioBody"></tbody>
                </table>
            </div>
             <div id="noAssetsMessage" style="display: none; text-align: center; padding: 30px 20px; color: var(--text-secondary); font-size: 14px;">
                Votre portefeuille est vide. Ajoutez votre premier actif ci-dessus.
            </div>
        </div>

        <div id="cryptoTickerBox" class="crypto-ticker-box">
            </div>
        <div class="footer">
            <div class="donation-info">
                <div class="donation-title">Soutenir ce Projet</div>
                <p class="donation-address"><strong>BTC:</strong> <span class="address">bc1q4rvquzg8ml4l4tgctzty47se8nyrprwqqfprun</span></p>
                <p class="donation-address"><strong>ETH:</strong> <span class="address">0x2dd9873A2DA36323d709A950a9a188B55289445a</span></p>
                <p class="donation-address"><strong>SOL:</strong> <span class="address">AKA6tNc9njdzfeoUJKz96joUvpXGnysSaDS1NxiTWqc4</span></p>
                <p class="donation-address"><strong>LTC:</strong> <span class="address">LQbaFwg1Qmj9wdwSv2P2tMpxck9NfAetFr</span></p>
            </div>
        </div>
    </div>

    <div id="removeModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="coin-icon" id="modalCoinIcon">?</div>
                <h3 class="modal-title">Supprimer <span id="modalCoinName">l'Actif</span></h3>
            </div>
            <div class="modal-message">
                Êtes-vous sûr de vouloir supprimer cet actif ? Cette action est irréversible.
            </div>
            <div class="modal-actions">
                <button id="cancelRemoveBtn" class="btn-cancel">Annuler</button>
                <button id="confirmRemoveBtn" class="btn-danger">Supprimer</button>
            </div>
        </div>
    </div>

    <script>
        // --- Variables Globales ---
        let portfolio = [];
        let websocket = null;
        let priceData = {};
        let amountInputs = {};
        let priceInputs = {};
        let currentRemoveId = null;
        let isPrivacyActive = false;

        const popularCryptos = [ { symbol: 'BTC', name: 'Bitcoin' }, { symbol: 'ETH', name: 'Ethereum' }, { symbol: 'BNB', name: 'Binance Coin' }, { symbol: 'SOL', name: 'Solana' }, { symbol: 'ADA', name: 'Cardano' }, { symbol: 'XRP', name: 'Ripple' }, { symbol: 'DOT', name: 'Polkadot' }, { symbol: 'DOGE', name: 'Dogecoin' }, { symbol: 'AVAX', name: 'Avalanche' }, { symbol: 'LINK', name: 'Chainlink' }, { symbol: 'MATIC', name: 'Polygon' }, { symbol: 'UNI', name: 'Uniswap' }, { symbol: 'LTC', name: 'Litecoin' }, { symbol: 'ATOM', name: 'Cosmos' }, { symbol: 'XLM', name: 'Stellar' }, { symbol: 'ALGO', name: 'Algorand' }, { symbol: 'NEAR', name: 'NEAR Protocol' }, { symbol: 'FTM', name: 'Fantom' }, { symbol: 'XTZ', name: 'Tezos' }, { symbol: 'EOS', name: 'EOS' }, { symbol: 'AAVE', name: 'Aave' }, { symbol: 'SAND', name: 'The Sandbox' }, { symbol: 'MANA', name: 'Decentraland' }, { symbol: 'CRO', name: 'Cronos' }, { symbol: 'FIL', name: 'Filecoin' } ];

        // --- Initialisation ---
        function init() {
            portfolio = JSON.parse(localStorage.getItem('cryptoPortfolioV3')) || [];
            isPrivacyActive = JSON.parse(localStorage.getItem('cryptoPrivacyModeV3')) || false;

            setupPrivacyMode();
            renderPortfolio();
            connectWebSocket();
            setupEventListeners();
            setupInputFormatting();
            feather.replace(); // Important to call after new icons are added to the DOM

            renderCryptoTickerBox();
            setInterval(renderCryptoTickerBox, 10000);
        }

        // --- Configuration des Écouteurs d'Événements ---
        function setupEventListeners() {
            document.getElementById('addBtn')?.addEventListener('click', addToPortfolio);
            document.getElementById('privacyToggle')?.addEventListener('click', togglePrivacyMode);
            // The bonusHuntBtn uses an onclick attribute now, so no explicit listener needed here unless you prefer that way.
            setupSymbolSuggestions();
            setupEnterKeyHandler();
            setupModalListeners();
            document.addEventListener('click', handleDocumentClickForDropdown);
        }

        // --- Mode Privé ---
        function setupPrivacyMode() {
            document.body.classList.toggle('privacy-enabled', isPrivacyActive);
            feather.replace();
        }
        function togglePrivacyMode() {
            isPrivacyActive = !isPrivacyActive;
            localStorage.setItem('cryptoPrivacyModeV3', JSON.stringify(isPrivacyActive));
            setupPrivacyMode();
        }

        // --- Logique de la Modale ---
        function setupModalListeners() {
            const modal = document.getElementById('removeModal');
            const cancelBtn = document.getElementById('cancelRemoveBtn');
            const confirmBtn = document.getElementById('confirmRemoveBtn');
            const modalOverlay = document.querySelector('.modal-overlay');

            [cancelBtn, modalOverlay].forEach(el => {
                el?.addEventListener('click', (event) => {
                    if (event.target === modalOverlay || event.target === cancelBtn) {
                        modal?.classList.remove('active');
                        currentRemoveId = null;
                    }
                });
            });

            confirmBtn?.addEventListener('click', () => {
                if (currentRemoveId !== null) {
                    portfolio = portfolio.filter(item => item.id.toString() !== currentRemoveId.toString());
                    savePortfolio();
                    delete amountInputs[`${currentRemoveId}-amount`];
                    delete priceInputs[`${currentRemoveId}-price`];
                    connectWebSocket();
                    renderPortfolio();
                    renderCryptoTickerBox();
                    modal?.classList.remove('active');
                    currentRemoveId = null;
                }
            });
        }
        function showRemoveModal(id) {
            const itemToRemove = portfolio.find(item => item.id.toString() === id.toString());
            const modal = document.getElementById('removeModal');
            if (!itemToRemove || !modal) return;

            currentRemoveId = id;
            modal.querySelector('#modalCoinIcon').textContent = itemToRemove.symbol.charAt(0);
            modal.querySelector('#modalCoinIcon').style.backgroundColor = getColorForSymbol(itemToRemove.symbol);
            modal.querySelector('#modalCoinName').textContent = itemToRemove.symbol;
            modal.classList.add('active');
        }

        // --- Gestion des Entrées & Suggestions ---
        function setupEnterKeyHandler() {
            ['symbol', 'amount', 'purchasePrice'].forEach(id => {
                document.getElementById(id)?.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        addToPortfolio();
                    }
                });
            });
        }
        function setupInputFormatting() {
            ['amount', 'purchasePrice'].forEach(id => {
                const input = document.getElementById(id);
                input?.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/[^0-9.]/g, '');
                    const parts = value.split('.');
                    if (parts.length > 2) value = parts[0] + '.' + parts.slice(1).join('');
                    if (e.target.value !== value) e.target.value = value;
                });
            });
        }
        function setupSymbolSuggestions() {
            const symbolInput = document.getElementById('symbol');
            const suggestionsContainer = document.getElementById('symbolSuggestions');
            if (!symbolInput || !suggestionsContainer) return;

            symbolInput.addEventListener('focus', () => populateSuggestions(symbolInput.value));
            symbolInput.addEventListener('input', () => populateSuggestions(symbolInput.value));
        }

        function populateSuggestions(query) {
            const suggestionsContainer = document.getElementById('symbolSuggestions');
            const symbolInput = document.getElementById('symbol');
            if (!suggestionsContainer || !symbolInput) return;
            suggestionsContainer.innerHTML = '';
            const queryLower = query.trim().toLowerCase();

            let filteredCryptos;
            if (!queryLower && document.activeElement === symbolInput) {
                filteredCryptos = popularCryptos.slice(0, 10);
            } else if (queryLower) {
                filteredCryptos = popularCryptos.filter(crypto =>
                    crypto.symbol.toLowerCase().startsWith(queryLower) ||
                    crypto.name.toLowerCase().includes(queryLower)
                ).slice(0, 7);
            } else {
                 suggestionsContainer.classList.remove('active');
                 return;
            }

            if (!filteredCryptos || filteredCryptos.length === 0) {
                suggestionsContainer.classList.remove('active');
                return;
            }

            filteredCryptos.forEach(crypto => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.innerHTML = `<span class="coin-symbol">${crypto.symbol}</span> <span class="coin-name">${crypto.name}</span>`;
                item.addEventListener('click', () => {
                    symbolInput.value = crypto.symbol;
                    suggestionsContainer.classList.remove('active');
                    document.getElementById('amount')?.focus();
                });
                suggestionsContainer.appendChild(item);
            });
            suggestionsContainer.classList.add('active');
        }

        function handleDocumentClickForDropdown(event) {
            const dropdown = document.getElementById('symbolSuggestions');
            const symbolInput = document.getElementById('symbol');
            if (dropdown && symbolInput && !symbolInput.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        }

        // --- WebSocket ---
        function connectWebSocket() {
            if (websocket) websocket.close();

            const uniqueSymbols = [...new Set(portfolio.map(item => item.symbol.toLowerCase()))];
            if (uniqueSymbols.length === 0) {
                updateUIWithoutRender();
                return;
            }

            uniqueSymbols.forEach(symbol => {
                if (!priceData[symbol.toUpperCase()]) {
                    const item = portfolio.find(p => p.symbol.toLowerCase() === symbol);
                    priceData[symbol.toUpperCase()] = { price: item ? item.purchasePrice : 0, priceChangePercent: 0 };
                }
            });

            const symbols = uniqueSymbols.map(symbol => `${symbol}usdt@ticker`).join('/');
            const wsUrl = `wss://stream.binance.com:9443/ws/${symbols}`;
            websocket = new WebSocket(wsUrl);

            websocket.onopen = () => console.log('WebSocket Connecté');
            websocket.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    if (data?.s && data.c != null && data.P != null) {
                        const symbol = data.s.replace('USDT', '').toUpperCase();
                        priceData[symbol] = { price: parseFloat(data.c), priceChangePercent: parseFloat(data.P) };
                        updateUIForSymbol(symbol);
                    }
                } catch (e) { console.error("Erreur d'analyse WS:", e); }
            };
            websocket.onerror = (error) => console.error('Erreur WebSocket:', error);
            websocket.onclose = () => console.log('WebSocket Déconnecté');
        }

        // --- Gestion du Portefeuille ---
        function addToPortfolio() {
            const symbolInput = document.getElementById('symbol');
            const amountInput = document.getElementById('amount');
            const priceInput = document.getElementById('purchasePrice');

            const symbol = symbolInput?.value.trim().toUpperCase();
            const amountValue = amountInput?.value.trim();
            const priceValue = priceInput?.value.trim();

            if (!symbol || !amountValue || !priceValue) {
                alert('Veuillez remplir tous les champs.');
                return;
            }
            const amount = parseFloat(amountValue);
            const purchasePrice = parseFloat(priceValue);

            if (isNaN(amount) || amount <= 0 || isNaN(purchasePrice) || purchasePrice < 0) {
                alert("Veuillez entrer des nombres valides : montant (> 0), prix (>= 0).");
                return;
            }

            const newItem = {
                id: Date.now(),
                symbol: symbol,
                amount: amount,
                purchasePrice: purchasePrice,
                timeAdded: formatDate(new Date())
            };
            portfolio.push(newItem);
            savePortfolio();
            connectWebSocket();

            if (symbolInput) symbolInput.value = '';
            if (amountInput) amountInput.value = '';
            if (priceInput) priceInput.value = '';
            symbolInput?.focus();

            renderPortfolio();
            renderCryptoTickerBox();
        }

        function handleAmountUpdate(id, inputElement) {
            const value = inputElement.value.trim().replace(/,/g, '');
            let newAmount = parseFloat(value);
            const item = portfolio.find(item => item.id.toString() === id.toString());
            if (!item) return;

            if (isNaN(newAmount) || newAmount <= 0) {
                alert("Veuillez entrer un montant valide supérieur à 0.");
                inputElement.value = formatTokenAmount(item.amount);
                return;
            }
            if (item.amount !== newAmount) {
                item.amount = newAmount;
                savePortfolio();
                updateUIWithoutRender();
            }
            inputElement.value = formatTokenAmount(newAmount);
        }

        function handlePriceUpdate(id, inputElement) {
            const value = inputElement.value.trim().replace(/,/g, '');
            let newPrice = parseFloat(value);
            const item = portfolio.find(item => item.id.toString() === id.toString());
            if (!item) return;

            if (isNaN(newPrice) || newPrice < 0) {
                alert("Veuillez entrer un prix valide supérieur ou égal à 0.");
                inputElement.value = formatPrice(item.purchasePrice);
                return;
            }
            if (item.purchasePrice !== newPrice) {
                item.purchasePrice = newPrice;
                savePortfolio();
                updateUIWithoutRender();
            }
            inputElement.value = formatPrice(newPrice);
        }

        function savePortfolio() {
            localStorage.setItem('cryptoPortfolioV3', JSON.stringify(portfolio));
        }

        // --- Formatage ---
        function formatNumberWithCommas(number, maxDecimals = 8, minDecimals = 2) {
            if (typeof number !== 'number' || isNaN(number)) return "0.00";
            const absNumber = Math.abs(number);
            let decimals;
            if (absNumber === 0) decimals = minDecimals;
            else if (absNumber < 0.000001) decimals = maxDecimals;
            else if (absNumber < 0.01) decimals = 6;
            else if (absNumber < 1) decimals = 4;
            else decimals = minDecimals;

            decimals = Math.max(minDecimals, decimals);
            decimals = Math.min(maxDecimals, decimals);

            return number.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
        }
        function formatTokenAmount(number) {
            if (typeof number !== 'number' || isNaN(number)) return "0";
            let formatted = number.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 8 });
            if (formatted.includes('.')) {
                formatted = formatted.replace(/(\.[0-9]*[1-9])0+$/, '$1');
                formatted = formatted.replace(/\.$/, '');
            }
            return formatted;
        }
        function formatPrice(number) { return formatNumberWithCommas(number, 8, 2); }
        function formatPercentage(number) { return formatNumberWithCommas(number, 2, 2); }
        function formatDate(date) { return date.toLocaleDateString('fr-FR', { month: 'short', day: 'numeric', year: 'numeric' }); }
        function getColorForSymbol(symbol) {
            let h = 0; for (let i = 0; i < symbol.length; i++) h = symbol.charCodeAt(i) + ((h << 5) - h);
            return `hsl(${h % 360}, 65%, 45%)`;
        }

        // --- Affichage ---
        function renderPortfolio() {
            const tbody = document.getElementById('portfolioBody');
            const noAssetsMsg = document.getElementById('noAssetsMessage');
            if (!tbody) return;
            tbody.innerHTML = '';
            amountInputs = {};
            priceInputs = {};

            if (portfolio.length === 0) {
                if (noAssetsMsg) noAssetsMsg.style.display = 'block';
                updateSummary();
                return;
            }
            if (noAssetsMsg) noAssetsMsg.style.display = 'none';

            portfolio.sort((a, b) => a.symbol.localeCompare(b.symbol));

            portfolio.forEach(item => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', item.id);

                const tdAsset = document.createElement('td'), tdAmount = document.createElement('td'), tdPurchase = document.createElement('td'),
                      tdCurrentPrice = document.createElement('td'), tdTotalValue = document.createElement('td'),
                      tdProfitLoss = document.createElement('td'), tdActions = document.createElement('td');

                tdAmount.className = 'editable align-right sensitive-data';
                tdPurchase.className = 'editable align-right sensitive-data';
                tdTotalValue.className = 'align-right sensitive-data';
                tdProfitLoss.className = 'align-right sensitive-data';
                tdActions.className = 'align-right';

                tdAsset.innerHTML = `<div class="coin-info"><div class="coin-icon" style="background-color: ${getColorForSymbol(item.symbol)}">${item.symbol.charAt(0)}</div><div class="coin-name"><span class="coin-symbol">${item.symbol}</span><span class="coin-fullname tooltip">${item.timeAdded}<span class="tooltiptext">Ajouté: ${item.timeAdded}</span></span></div></div>`;

                const amountInput = document.createElement('input');
                amountInput.type = 'text'; amountInput.className = 'editable-amount';
                amountInput.value = formatTokenAmount(item.amount);
                amountInput.setAttribute('data-id', `${item.id}-amount`);
                amountInput.setAttribute('inputmode', 'decimal');
                amountInput.addEventListener('input', (e) => { let v = e.target.value.replace(/[^0-9.]/g, ''); const p = v.split('.'); if(p.length>2) v=p[0]+'.'+p.slice(1).join(''); if(e.target.value !== v) e.target.value = v; });
                amountInput.addEventListener('blur', (e) => handleAmountUpdate(item.id, e.target));
                amountInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') e.target.blur(); });
                tdAmount.appendChild(amountInput);
                amountInputs[`${item.id}-amount`] = amountInput;

                const priceContainer = document.createElement('div'); priceContainer.className = 'price-input-container';
                priceContainer.innerHTML = `<span class="dollar-sign">$</span>`;
                const priceInput = document.createElement('input');
                priceInput.type = 'text'; priceInput.className = 'editable-price';
                priceInput.value = formatPrice(item.purchasePrice);
                priceInput.setAttribute('data-id', `${item.id}-price`);
                priceInput.setAttribute('inputmode', 'decimal');
                priceInput.addEventListener('input', (e) => { let v = e.target.value.replace(/[^0-9.]/g, ''); const p = v.split('.'); if(p.length>2) v=p[0]+'.'+p.slice(1).join(''); if(e.target.value !== v) e.target.value = v; });
                priceInput.addEventListener('blur', (e) => handlePriceUpdate(item.id, e.target));
                priceInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') e.target.blur(); });
                priceContainer.appendChild(priceInput);
                tdPurchase.appendChild(priceContainer);
                priceInputs[`${item.id}-price`] = priceInput;

                tdCurrentPrice.innerHTML = `<div class="price-change"><span id="price-container-${item.id}"></span><span class="percentage" id="change-${item.id}"></span></div>`;
                tdTotalValue.innerHTML = `<span class="currency-symbol">$</span><span id="value-${item.id}"></span>`;
                tdProfitLoss.innerHTML = `<span id="pl-${item.id}"><span class="currency-symbol"></span><span class="value"></span><span class="percentage"><span class="pl-percent-value"></span></span></span>`;

                const trashButton = document.createElement('button');
                trashButton.className = 'trash-button tooltip';
                trashButton.innerHTML = `<i data-feather="trash-2" class="feather"></i> <span class="tooltiptext">Supprimer ${item.symbol}</span>`;
                trashButton.onclick = () => showRemoveModal(item.id);
                tdActions.appendChild(trashButton);

                row.appendChild(tdAsset); row.appendChild(tdAmount); row.appendChild(tdPurchase);
                row.appendChild(tdCurrentPrice); row.appendChild(tdTotalValue); row.appendChild(tdProfitLoss);
                row.appendChild(tdActions);
                tbody.appendChild(row);

                const currentPriceData = priceData[item.symbol] || { price: item.purchasePrice, priceChangePercent: 0 };
                updateRowValues(item.id, currentPriceData.price, currentPriceData.priceChangePercent);
            });
            updateSummary();
            feather.replace();
        }

        function updateUIForSymbol(symbol) {
            portfolio.forEach(item => {
                if (item.symbol === symbol) {
                    const d = priceData[symbol] || { price: item.purchasePrice, priceChangePercent: 0 };
                    updateRowValues(item.id, d.price, d.priceChangePercent);
                }
            });
            updateSummary();
            renderCryptoTickerBox();
        }

        function updateRowValues(id, currentPrice, priceChangePercent) {
            const row = document.querySelector(`tr[data-id="${id}"]`);
            if (!row) return;
            const item = portfolio.find(p => p.id.toString() === id.toString());
            if (!item) return;

            const amount = item.amount;
            const purchasePrice = item.purchasePrice;
            const totalValue = amount * currentPrice;
            const invested = amount * purchasePrice;
            const profitLoss = totalValue - invested;
            const profitLossPercentage = invested !== 0 ? (profitLoss / invested) * 100 : 0;
            const profitLossClass = profitLoss >= 0 ? 'positive' : 'negative';

            const priceContainer = row.querySelector(`#price-container-${id}`);
            const changeElement = row.querySelector(`#change-${id}`);
            const valueElement = row.querySelector(`#value-${id}`);
            const plElement = row.querySelector(`#pl-${id}`);

            if (priceContainer) priceContainer.innerHTML = `<span class="currency-symbol">$</span>${formatPrice(currentPrice)}`;
            if (changeElement) {
                changeElement.textContent = `${priceChangePercent >= 0 ? '+' : ''}${formatPercentage(priceChangePercent)}%`;
                changeElement.className = `percentage ${priceChangePercent >= 0 ? 'positive' : 'negative'}`;
            }
            if (valueElement) valueElement.textContent = formatNumberWithCommas(totalValue, 2);
            if (plElement) {
                plElement.className = profitLossClass;
                plElement.querySelector('.value').textContent = formatNumberWithCommas(Math.abs(profitLoss), 2);
                plElement.querySelector('.pl-percent-value').textContent = `(${profitLossPercentage >= 0 ? '+' : ''}${formatPercentage(profitLossPercentage)}%)`;
                plElement.querySelector('.percentage').className = `percentage ${profitLossClass}`;
                plElement.querySelector('.currency-symbol').textContent = `${profitLoss >= 0 ? '' : '-'}$`;
            }
        }

        function updateUIWithoutRender() {
            portfolio.forEach(item => {
                const d = priceData[item.symbol] || { price: item.purchasePrice, priceChangePercent: 0 };
                updateRowValues(item.id, d.price, d.priceChangePercent);
            });
            updateSummary();
            renderCryptoTickerBox();
        }

        function updateSummary() {
            let totalInvested = 0;
            let totalValue = 0;
            portfolio.forEach(item => {
                const currentPrice = priceData[item.symbol]?.price ?? item.purchasePrice;
                totalInvested += item.amount * item.purchasePrice;
                totalValue += item.amount * currentPrice;
            });

            const netProfitLoss = totalValue - totalInvested;
            const netProfitLossPercentage = totalInvested !== 0 ? (netProfitLoss / totalInvested) * 100 : 0;
            const profitLossClass = netProfitLoss >= 0 ? 'positive' : 'negative';

            document.getElementById('totalInvested').textContent = formatNumberWithCommas(totalInvested, 2);
            document.getElementById('totalValue').textContent = formatNumberWithCommas(totalValue, 2);

            const netPLContainer = document.getElementById('netProfitLossContainer');
            if (!netPLContainer) return;
            const netPLElement = netPLContainer.querySelector('#netProfitLoss');
            const netPLPercentageElement = netPLContainer.querySelector('#netProfitLossPercentage');
            const netPLCurrencySymbol = netPLContainer.querySelector('.currency-symbol');
            const netPLPercentageWrapper = netPLContainer.querySelector('.percentage');

            netPLContainer.className = `summary-value ${profitLossClass}`;
            if(netPLElement) netPLElement.textContent = formatNumberWithCommas(Math.abs(netProfitLoss), 2);
            if(netPLCurrencySymbol) netPLCurrencySymbol.textContent = `${netProfitLoss >= 0 ? '' : '-'}$`;
            if(netPLPercentageElement) netPLPercentageElement.textContent = `${netProfitLossPercentage >= 0 ? '+' : ''}${formatPercentage(netProfitLossPercentage)}%`;
            if(netPLPercentageWrapper) netPLPercentageWrapper.className = `percentage ${profitLossClass}`;
        }

        function renderCryptoTickerBox() {
            const tickerBox = document.getElementById('cryptoTickerBox');
            if (!tickerBox) return;

            if (portfolio.length === 0) {
                tickerBox.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; color: var(--text-secondary); font-size: 0.9em;">Portefeuille vide</div>`;
                return;
            }

            let htmlContent = '';
            const sortedPortfolioForTicker = [...portfolio].sort((a, b) => a.symbol.localeCompare(b.symbol));

            sortedPortfolioForTicker.forEach(item => {
                const currentData = priceData[item.symbol.toUpperCase()];
                const currentPrice = currentData ? currentData.price : item.purchasePrice;
                const priceChangePercent = currentData ? currentData.priceChangePercent : 0;
                const changeClass = priceChangePercent >= 0 ? 'positive' : 'negative';

                htmlContent += `
                    <div class="crypto-ticker-item">
                        <span class="crypto-ticker-symbol">${item.symbol}</span>
                        <span class="crypto-ticker-price">$${formatPrice(currentPrice)}</span>
                        <span class="crypto-ticker-change">
                            <span class="percentage ${changeClass}">
                                ${priceChangePercent >= 0 ? '+' : ''}${formatPercentage(priceChangePercent)}%
                            </span>
                        </span>
                    </div>
                `;
            });
            tickerBox.innerHTML = htmlContent;
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
